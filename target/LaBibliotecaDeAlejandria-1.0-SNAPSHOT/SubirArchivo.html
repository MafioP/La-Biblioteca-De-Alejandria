<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biblioteca Alejandría</title>

    <!--CUSTOM CSS-->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <nav class="navMain">
          <div id="sideNavMenu" class="sideNav" onmouseleave="closeBiblioteca()">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a href="#" onmouseenter="openBiblioteca()">Mi biblioteca</a>
              <ul id="itemBiblio1">Favoritos ★</ul>
              <ul id="itemBiblio2">Tercero Carrera</ul>
              <ul id="itemBiblio3">+ Crear Nueva</ul>
            <a href="SubirArchivo.html">Subir Archivos</a>
            <a href="#">Ajustes</a>
          </div>
          <span onclick="openNav()"><img src="img/menuLogo.png"  class="menu-sidebar"></span>
        <ul class="navBanner">
          <a href="MainPage.html"><img src="img/Logo.png" class= "bannerLogo" alt="Logo Imagen"></a>
        </ul>
            <ul class="navLogIn">
              <div class="dropdown">
                <button class="dropbtn"><img src="img/logoInicioSesion.png" width="50px"></button>
                <div class="dropdown-content">
                  <a href="InicioSesion.html">Iniciar sesión</a>
                  <a href="Registro.html">Registrarse</a>
                </div>
              </div>
            </ul>    
        </nav>
        <div class="area-subir">
          <div class="drag-area">
            <h2>Arrastra y suelta un archivo</h2>
            <span>O</span>
            <button>Selecciona tu archivo</button>
            <input type="file" name="" id="input-file" hidden multiple/>
            <div id="preview"></div>
          </div>
          
          <div class="subir-box" id="info-box">
              <h1>Subir archivo</h1>
              <form>
                <!-- TITULO INPUT -->
                <label for="titulo">Título</label>
                <input type="text" placeholder="Introduce el título">
                <!-- UNIVERSIDAD INPUT -->
                <label for="universidad">Universidad</label>
                <input type="text" placeholder="Introduce nombre de la universidad">
                <!-- GRADO INPUT -->
                <label for="grado">Grado</label>
                <input type="text" placeholder="Introduce el grado">
                <!-- CURSO INPUT -->
                <label for="curso">Curso</label>
                <input type="text" placeholder="Introduce el curso">
                <!-- CUATRI INPUT -->
                <label for="cuatri">Cuatrimestre</label>
                <input type="text" placeholder="Introduce el cuatrimestre">               
                <!-- ASIGNATURA INPUT -->
                <label for="asignatura">Asignatura</label>
                <input type="text" placeholder="Introduce la asignatura">
                <!-- DESCRIPCION INPUT -->
                <label for="descripción">Descripción</label>
                <input type="text" placeholder="Introduce la descripción">
                <input type="submit" value="Subir Archivo">
                
              </form>
            </div>
        </div>
    </div>
    <!--CUSTOM JS-->
    <script>
    //Seleccinando los elementos requeridos del html
    const dropArea = document.querySelector(".drag-area"),
    dragText = dropArea.querySelector("h2"),
    button = dropArea.querySelector("button"),
    input = dropArea.querySelector("input");
    let file;

    button.onclick = ()=>{
      input.click(); //Abre el input cuando hay click
    }

    input.addEventListener("change", function(){
      
      file = this.files[0]; //Si hay muchos archivos seleciona el primero
      dropArea.classList.add("active");
      processFile(file);
      dropArea.classList.remove("active");
    });


    //Si el usuario arrastra el archivo sobre DropArea
    dropArea.addEventListener("dragover", (event)=>{
      event.preventDefault();
      dropArea.classList.add("active");
      dragText.textContent = "Suelta para subir el archivo";
    });

    //Si el usuario deja el archivo arrastrado desde DropArea
    dropArea.addEventListener("dragleave", ()=>{
      dropArea.classList.remove("active");
      dragText.textContent = "Arrastra y suelta para subir el archivo";
    });

    //Si el usuario suelta el archivo en DropArea
    dropArea.addEventListener("drop", (event)=>{
      event.preventDefault();
      file = event.dataTransfer.files[0]; //Si hay muchos archivos seleciona el primero
      processFile(file);
    });

    function processFile(file){
      
        let preview = document.getElementById("preview");
        if(preview.hasChildNodes()){
          while(preview.childNodes.length>=1){
            preview.removeChild(preview.firstChild);
          }
        }
        showFile(file);
    }

    function showFile(file){
      let fileType = file.type; //Obtiene el tipo de archivo
      let validExtensions = ["image/jpeg", "image/jpg", "image/png", "application/pdf", 
      "application/vnd.openxmlformats-officedocument.wordprocessingml.document", 
      "application/vnd.openxmlformats-officedocument.presentationml.presentation"]; //Añade las extensiones validas al array
      if(validExtensions.includes(fileType)){ //Si la extension es valida
        let fileReader = new FileReader();
        let id = `file-${Math.random().toString(32).substring(7)}`;

        fileReader.addEventListener('load', e =>{
          let fileURL = fileReader.result;
          let archivo = `
            <div id="${id}" class="file-container">
              <img src="${fileURL}" alt="${file.name}" width="50px">
              <div class="status">
                <span class="status-text">
                  Cargando...
                </span>
              </div>
            </div>
          `;

          const html = document.querySelector("#preview").innerHTML;
          document.querySelector('#preview').innerHTML = archivo + html;
        });
          
        fileReader.readAsDataURL(file);

      }else{
        alert("La extensión del archivo no es válida");
        dropArea.classList.remove("active");
        dragText.textContent = "Arrastra y suelta para subir un archivo";
      }
    }


    /*Funcionalidad de SideBar */
    function openNav() {
      document.getElementById("sideNavMenu").style.width = "250px";
    }

    /*Pone el width = 0 del sidebar*/
    function closeNav() {
      document.getElementById("sideNavMenu").style.width = "0";
    }

    function openBiblioteca() {
      document.getElementById("itemBiblio1").style.display = "block";
      document.getElementById("itemBiblio2").style.display = "block";
      document.getElementById("itemBiblio3").style.display = "block";
    }
    function closeBiblioteca() {
      document.getElementById("itemBiblio1").style.display = "none";
      document.getElementById("itemBiblio2").style.display = "none";
      document.getElementById("itemBiblio3").style.display = "none";
    }
    </script>
</body>